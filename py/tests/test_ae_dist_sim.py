import pytest
from pytest import approx
import numpy as np

def test_simulate_ae_dist():
	from cmap_trip.ae_distance_sim import simulate_ae_dist
	p1 = [0.89, 0.85, 0.9 , 0.83, 0.75]
	p2 = [0.2, 0.2, 0.2, 0.2, 0.2]
	p3 = [101, 101, 101, 101, 101]
	assert simulate_ae_dist(p1, p2, p3, random_state=1).reshape(-1) == approx(
		[1.214869, 0.72764874, 0.79436564, 0.6154063, 0.9230815]
	)
	assert simulate_ae_dist(p1, p2, p3, random_state=1, replication=5) == approx(
		np.array([
			[1.214869  , 0.72764874, 0.79436564, 0.6154063 , 0.9230815 ],
			[0.42969227, 1.1989623 , 0.7477586 , 0.8938078 , 0.70012593],
			[1.1824216 , 0.43797186, 0.8355166 , 0.75318915, 0.9767539 ],
			[0.6700218 , 0.8155144 , 0.7244283 , 0.83844274, 0.866563  ],
			[0.66987616, 1.0789447 , 1.0803181 , 0.93049884, 0.9301712 ],
		])
	)

	p1 = [0.1, 0.1, 0.1, 0.1, 10.1]
	p2 = [0.2, 0.2, 0.2, 0.2, 10.2]
	p3 = [0.25, 0.369, 0.802, 0.846, 0.913]
	assert simulate_ae_dist(p1, p2, p3, random_state=1).reshape(-1) == approx(
		[0.1564524, 0.17953482, 0.10001285, 0.13205005, 10.1152638]
	)
	assert simulate_ae_dist(p1, p2, p3, random_state=1, replication=5) == approx(
		np.array([
			[0.1564524 , 0.17953482, 0.10001285, 0.13205005, 10.115264],
			[0.11814567, 0.12789729, 0.13712075, 0.14170493, 10.155007],
			[0.1566538 , 0.17674743, 0.12235227, 0.18865107, 10.102865],
			[0.17750695, 0.15320611, 0.15853587, 0.11510868, 10.120553],
			[0.18690333, 0.19781241, 0.13380104, 0.17095165, 10.188115],
		])
	)

